<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CricMetrics | Grounds-Master Dashboard</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;700;900&display=swap');

        :root {
            --primary: #1b5e20;
            --accent: #ffd700;
            --bg-overlay: rgba(0, 0, 0, 0.4);
            --glass-bg: rgba(255, 255, 255, 0.12);
            --glass-border: rgba(255, 255, 255, 0.2);
            --indicator-red: #ff3b3b;
        }

        html, body {
            margin: 0; padding: 0; width: 100%; min-height: 100vh;
            display: flex; flex-direction: column;
            background: url("https://images.unsplash.com/photo-1531415074968-036ba1b575da?q=80&w=2000") no-repeat center center fixed;
            background-size: cover; font-family: 'Poppins', sans-serif;
        }

        .outer { flex: 1; display: flex; flex-direction: column; align-items: center; background: var(--bg-overlay); padding: 40px 20px; }

        /* Header Styling */
        .header-container { padding: 20px 0; text-align: center; }
        .brand-title { font-size: 2.8rem; font-weight: 400; color: #ffffff; margin: 0; letter-spacing: -1px; text-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .brand-title b { font-weight: 900; color: var(--accent); }
        .header-tagline { font-size: 0.85rem; color: rgba(255, 255, 255, 0.7); text-transform: uppercase; letter-spacing: 3px; margin-top: -5px; }

        /* Main Glass Container */
        .main-container {
            background: var(--glass-bg); backdrop-filter: blur(20px) saturate(180%); -webkit-backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid var(--glass-border); border-radius: 20px; padding: 40px; width: 100%; max-width: 1100px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5); display: flex; flex-direction: column; gap: 30px;
        }

        .dashboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 25px; }

        /* Card Styling */
        .card {
            background: rgba(255, 255, 255, 0.1) !important; backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.15); padding: 25px; border-radius: 15px; color: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .card h3 { color: var(--accent); margin-top: 0; font-size: 1.2rem; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px; }

        .input-group { margin-bottom: 15px; }
        label { display: block; font-size: 0.85rem; font-weight: 600; margin-bottom: 5px; color: rgba(255,255,255,0.8); }
        input { width: 100%; padding: 10px; background: rgba(255, 255, 255, 0.9); border: 1px solid transparent; border-radius: 8px; font-size: 1rem; outline: none; transition: all 0.3s; color: #333; }
        input:focus { border-color: var(--accent); box-shadow: 0 0 10px var(--accent); }

        .btn-apply { width: 100%; padding: 15px; background: #007bff; color: white; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; font-size: 1rem; margin-top: 10px; transition: 0.3s; }
        .btn-apply:hover { background: #0056b3; transform: translateY(-2px); }

        /* Stats Grid */
        .stats-grid { display: grid; grid-template-columns: 1fr; gap: 10px; }
        .stat-box { background: rgba(0, 0, 0, 0.3); padding: 15px; border-radius: 10px; border-left: 4px solid var(--accent); text-align: center; }
        .stat-label { font-size: 0.7rem; color: rgba(255,255,255,0.6); text-transform: uppercase; }
        .stat-value { font-size: 1.4rem; font-weight: bold; color: white; }

        #canvas-container { margin-top: 20px; background: rgba(255, 255, 255, 0.05); border-radius: 10px; padding: 15px; }

        /* Reference Table Styling */
        .reference-card { background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 15px; padding: 25px; margin-top: 10px; }
        .ref-table { width: 100%; border-collapse: collapse; color: white; font-size: 0.9rem; }
        .ref-table th { color: var(--accent); text-transform: uppercase; font-size: 0.75rem; padding: 15px; border-bottom: 2px solid rgba(255, 255, 255, 0.1); text-align: center; }
        .ref-table td { padding: 15px; border-bottom: 1px solid rgba(255, 255, 255, 0.05); text-align: center; }
        .ref-table td:first-child { text-align: left; font-weight: 700; }
        .ref-table tr:hover { background: rgba(255, 255, 255, 0.15); cursor: pointer; }
        .dimensions-badge { background: rgba(0, 162, 255, 0.2); color: #00c6ff; padding: 4px 10px; border-radius: 6px; font-family: monospace; font-weight: bold; }

        footer { width: 100%; padding: 30px 0; background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(10px); color: rgba(255, 255, 255, 0.6); text-align: center; }
        .footer-links a { color: var(--accent); text-decoration: none; margin: 0 15px; font-weight: 600; }
    </style>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üèè</text></svg>">
</head>
<body>

<div class="outer">
    <div class="header-container">
        <h1 class="brand-title">Cric<b>Metrics</b></h1>
        <div class="header-tagline">Advanced Venue Analytics</div>
    </div>

    <div class="main-container">
        <div class="dashboard">
            <div class="card">
                <h3>Field Dimensions</h3>
                <div class="input-group">
                    <label>Major Axis (Length m)</label>
                    <input type="number" id="major" value="150" oninput="updateDashboard()" onfocus="setActiveIndicator('major')" onblur="setActiveIndicator(null)">
                </div>
                <div class="input-group">
                    <label>Minor Axis (Width m)</label>
                    <input type="number" id="minor" value="130" oninput="updateDashboard()" onfocus="setActiveIndicator('minor')" onblur="setActiveIndicator(null)">
                </div>
                <div class="input-group">
                    <label>Pitch Length (m)</label>
                    <input type="number" id="pLen" value="20.12" oninput="updateDashboard()">
                </div>
                <div class="input-group">
                    <label>Pitch Width (m)</label>
                    <input type="number" id="pWid" value="3.05" oninput="updateDashboard()">
                </div>
                <button onclick="applyToForm()" class="btn-apply">Apply Area to Predictor</button>
            </div>

            <div class="card">
                <h3>Analysis Results</h3>
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-label">Total Boundary Area</div>
                        <div class="stat-value"><span id="resTotal">0</span> <small>m¬≤</small></div>
                    </div>
                </div>
                <div id="canvas-container">
                    <canvas id="fieldPreview" width="300" height="220"></canvas>
                    <p style="font-size: 0.7rem; color: rgba(255,255,255,0.5); text-align:center; margin-top:5px;">Live Proportion Preview (Human for Scale)</p>
                </div>
            </div>
        </div>

        <div class="reference-card">
            <h3 style="color: var(--accent); margin-top: 0; font-size: 1.1rem; text-align: center;">üèüÔ∏è Stadium Benchmark Data</h3>
            <table class="ref-table">
                <thead>
                    <tr>
                        <th>Stadium</th>
                        <th>Location</th>
                        <th>Maj / Min (m)</th>
                        <th>Est. Area</th>
                    </tr>
                </thead>
                <tbody>
                    <tr onclick="fillDimensions(172, 148)">
                        <td>MCG</td>
                        <td>Melbourne</td>
                        <td><span class="dimensions-badge">172 x 148</span></td>
                        <td>20,000 m¬≤</td>
                    </tr>
                    <tr onclick="fillDimensions(155, 138)">
                        <td>Lord's</td>
                        <td>London</td>
                        <td><span class="dimensions-badge">155 x 138</span></td>
                        <td>16,800 m¬≤</td>
                    </tr>
                    <tr onclick="fillDimensions(160, 142)">
                        <td>Eden Gardens</td>
                        <td>Kolkata</td>
                        <td><span class="dimensions-badge">160 x 142</span></td>
                        <td>17,844 m¬≤</td>
                    </tr>
                    <tr onclick="fillDimensions(170, 150)">
                        <td>Narendra Modi</td>
                        <td>Ahmedabad</td>
                        <td><span class="dimensions-badge">170 x 150</span></td>
                        <td>20,027 m¬≤</td>
                    </tr>
                </tbody>
            </table>
            <p style="color: rgba(255,255,255,0.4); font-size: 0.75rem; text-align: center; margin-top: 15px;">
                * Click a row to auto-load benchmark dimensions into the calculator.
            </p>
        </div>
    </div>
</div>

<footer>
    <div class="footer-links">
        <a href="{{ url_for('predict_datapoint') }}">Predictor Engine</a>
        <span>Venue Analytics</span>
    </div>
    <p>&copy; 2026 CricMetrics Analytics. All rights reserved.</p>
</footer>

<script>
    let activeIndicator = null;

    function setActiveIndicator(type) {
        activeIndicator = type;
        updateDashboard();
    }

    function fillDimensions(major, minor) {
        document.getElementById('major').value = major;
        document.getElementById('minor').value = minor;
        updateDashboard();
        // Visual feedback
        const inputs = [document.getElementById('major'), document.getElementById('minor')];
        inputs.forEach(i => {
            i.style.borderColor = "#ffd700";
            setTimeout(() => { i.style.borderColor = "transparent"; }, 500);
        });
    }

    function updateDashboard() {
        const major = parseFloat(document.getElementById('major').value) || 0;
        const minor = parseFloat(document.getElementById('minor').value) || 0;
        const pL = parseFloat(document.getElementById('pLen').value) || 0;
        const pW = parseFloat(document.getElementById('pWid').value) || 0;

        const totalArea = Math.PI * (major / 2) * (minor / 2);
        document.getElementById('resTotal').innerText = totalArea.toLocaleString(undefined, {maximumFractionDigits: 0});

        drawField(major, minor, pL, pW);
    }

    function drawField(maj, min, pl, pw) {
        const canvas = document.getElementById('fieldPreview');
        const ctx = canvas.getContext('2d');
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;
        const scale = Math.min(canvas.width / (maj * 1.3), canvas.height / (min * 1.3));

        const rMaj = (maj / 2) * scale;
        const rMin = (min / 2) * scale;

        // Boundary
        ctx.beginPath();
        ctx.ellipse(centerX, centerY, rMaj, rMin, 0, 0, 2 * Math.PI);
        ctx.fillStyle = "rgba(76, 175, 80, 0.5)";
        ctx.fill();
        ctx.strokeStyle = "rgba(255, 255, 255, 0.8)";
        ctx.lineWidth = 2;
        ctx.stroke();

        // Pitch
        ctx.fillStyle = "#deb887";
        const pitchX = centerX - (pw/2)*scale;
        const pitchY = centerY - (pl/2)*scale;
        const pitchW = pw*scale;
        const pitchH = pl*scale;
        ctx.fillRect(pitchX, pitchY, pitchW, pitchH);

        // Human Silhouette (1.8m)
        const humanHeight = 1.8 * scale;
        const humanX = pitchX + pitchW + 8;
        const humanY = centerY + (pl/4)*scale;

        ctx.fillStyle = "#ffffff";
        ctx.beginPath();
        ctx.arc(humanX, humanY - humanHeight * 0.8, humanHeight * 0.1, 0, Math.PI * 2);
        ctx.fill();
        ctx.fillRect(humanX - humanHeight * 0.05, humanY - humanHeight * 0.7, humanHeight * 0.1, humanHeight * 0.4);
        
        ctx.font = "bold 9px Arial";
        ctx.fillText("Human (1.8m)", humanX - 25, humanY + 12);

        // Live Red Axis Indicator
        if (activeIndicator) {
            ctx.setLineDash([5, 5]);
            ctx.strokeStyle = "#ff3b3b";
            ctx.beginPath();
            if (activeIndicator === 'major') {
                ctx.moveTo(centerX - rMaj, centerY);
                ctx.lineTo(centerX + rMaj, centerY);
                ctx.stroke();
                ctx.fillText(maj + 'm', centerX - 10, centerY - 8);
            } else {
                ctx.moveTo(centerX, centerY - rMin);
                ctx.lineTo(centerX, centerY + rMin);
                ctx.stroke();
                ctx.fillText(min + 'm', centerX + 8, centerY);
            }
            ctx.setLineDash([]);
        }
    }

    function applyToForm() {
        const totalArea = document.getElementById('resTotal').innerText.replace(/,/g, '');
        sessionStorage.setItem('calculatedArea', totalArea);
        window.location.href = "{{ url_for('predict_datapoint') }}";
    }

    updateDashboard();
</script>

</body>
</html>